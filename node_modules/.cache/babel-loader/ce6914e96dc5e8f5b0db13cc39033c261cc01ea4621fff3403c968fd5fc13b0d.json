{"ast":null,"code":"import { worldToLngLat } from './web-mercator-utils';\nimport * as vec2 from 'gl-matrix/vec2';\nimport { transformVector } from './math-utils';\nconst DEGREES_TO_RADIANS = Math.PI / 180;\nexport default function getBounds(viewport) {\n  let z = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  const {\n    width,\n    height,\n    unproject\n  } = viewport;\n  const unprojectOps = {\n    targetZ: z\n  };\n  const bottomLeft = unproject([0, height], unprojectOps);\n  const bottomRight = unproject([width, height], unprojectOps);\n  let topLeft;\n  let topRight;\n  const halfFov = viewport.fovy ? 0.5 * viewport.fovy * DEGREES_TO_RADIANS : Math.atan(0.5 / viewport.altitude);\n  const angleToGround = (90 - viewport.pitch) * DEGREES_TO_RADIANS;\n  if (halfFov > angleToGround - 0.01) {\n    topLeft = unprojectOnFarPlane(viewport, 0, z);\n    topRight = unprojectOnFarPlane(viewport, width, z);\n  } else {\n    topLeft = unproject([0, 0], unprojectOps);\n    topRight = unproject([width, 0], unprojectOps);\n  }\n  return [bottomLeft, bottomRight, topRight, topLeft];\n}\nfunction unprojectOnFarPlane(viewport, x, targetZ) {\n  const {\n    pixelUnprojectionMatrix\n  } = viewport;\n  const coord0 = transformVector(pixelUnprojectionMatrix, [x, 0, 1, 1]);\n  const coord1 = transformVector(pixelUnprojectionMatrix, [x, viewport.height, 1, 1]);\n  const z = targetZ * viewport.distanceScales.unitsPerMeter[2];\n  const t = (z - coord0[2]) / (coord1[2] - coord0[2]);\n  const coord = vec2.lerp([], coord0, coord1, t);\n  const result = worldToLngLat(coord);\n  result.push(targetZ);\n  return result;\n}","map":{"version":3,"names":["worldToLngLat","vec2","transformVector","DEGREES_TO_RADIANS","Math","PI","getBounds","viewport","z","arguments","length","undefined","width","height","unproject","unprojectOps","targetZ","bottomLeft","bottomRight","topLeft","topRight","halfFov","fovy","atan","altitude","angleToGround","pitch","unprojectOnFarPlane","x","pixelUnprojectionMatrix","coord0","coord1","distanceScales","unitsPerMeter","t","coord","lerp","result","push"],"sources":["/Users/maks/Desktop/projects/geo-viz/node_modules/@math.gl/web-mercator/src/get-bounds.ts"],"sourcesContent":["import {worldToLngLat} from './web-mercator-utils';\nimport * as vec2 from 'gl-matrix/vec2';\nimport {transformVector} from './math-utils';\nimport type WebMercatorViewport from './web-mercator-viewport';\n\nconst DEGREES_TO_RADIANS = Math.PI / 180;\n\n/*\n * Returns the quad at the intersection of the frustum and the given z plane\n * @param {WebMercatorViewport} viewport\n * @param {Number} z - elevation in meters\n */\nexport default function getBounds(viewport: WebMercatorViewport, z: number = 0): number[][] {\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  const {width, height, unproject} = viewport;\n  const unprojectOps = {targetZ: z};\n  const bottomLeft = unproject([0, height], unprojectOps);\n  const bottomRight = unproject([width, height], unprojectOps);\n  let topLeft: number[];\n  let topRight: number[];\n\n  const halfFov = viewport.fovy\n    ? 0.5 * viewport.fovy * DEGREES_TO_RADIANS\n    : Math.atan(0.5 / viewport.altitude);\n  const angleToGround = (90 - viewport.pitch) * DEGREES_TO_RADIANS;\n  // The top plane is parallel to the ground if halfFov == angleToGround\n  if (halfFov > angleToGround - 0.01) {\n    // intersect with the far plane\n    topLeft = unprojectOnFarPlane(viewport, 0, z);\n    topRight = unprojectOnFarPlane(viewport, width, z);\n  } else {\n    // intersect with the top plane\n    topLeft = unproject([0, 0], unprojectOps);\n    topRight = unproject([width, 0], unprojectOps);\n  }\n\n  return [bottomLeft, bottomRight, topRight, topLeft];\n}\n\n/*\n * Find a point on the far clipping plane of the viewport\n * @param {WebMercatorViewport} viewport\n * @param {Number} x - projected x in screen space\n * @param {Number} targetZ - the elevation of the point in meters\n */\nfunction unprojectOnFarPlane(viewport: WebMercatorViewport, x: number, targetZ: number): number[] {\n  const {pixelUnprojectionMatrix} = viewport;\n  const coord0 = transformVector(pixelUnprojectionMatrix, [x, 0, 1, 1]);\n  const coord1 = transformVector(pixelUnprojectionMatrix, [x, viewport.height, 1, 1]);\n\n  const z = targetZ * viewport.distanceScales.unitsPerMeter[2];\n  const t = (z - coord0[2]) / (coord1[2] - coord0[2]);\n  const coord = vec2.lerp([], coord0, coord1, t);\n\n  const result = worldToLngLat(coord);\n  result.push(targetZ);\n  return result;\n}\n"],"mappings":"AAAA,SAAQA,aAAR,QAA4B,sBAA5B;AACA,OAAO,KAAKC,IAAZ,MAAsB,gBAAtB;AACA,SAAQC,eAAR,QAA8B,cAA9B;AAGA,MAAMC,kBAAkB,GAAGC,IAAI,CAACC,EAAL,GAAU,GAArC;AAOA,eAAe,SAASC,SAATA,CAAmBC,QAAnB,EAA6E;EAAA,IAA3BC,CAAS,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAA9D;EAEb,MAAM;IAACG,KAAD;IAAQC,MAAR;IAAgBC;EAAhB,IAA6BP,QAAnC;EACA,MAAMQ,YAAY,GAAG;IAACC,OAAO,EAAER;EAAV,CAArB;EACA,MAAMS,UAAU,GAAGH,SAAS,CAAC,CAAC,CAAD,EAAID,MAAJ,CAAD,EAAcE,YAAd,CAA5B;EACA,MAAMG,WAAW,GAAGJ,SAAS,CAAC,CAACF,KAAD,EAAQC,MAAR,CAAD,EAAkBE,YAAlB,CAA7B;EACA,IAAII,OAAJ;EACA,IAAIC,QAAJ;EAEA,MAAMC,OAAO,GAAGd,QAAQ,CAACe,IAAT,GACZ,MAAMf,QAAQ,CAACe,IAAf,GAAsBnB,kBADV,GAEZC,IAAI,CAACmB,IAAL,CAAU,MAAMhB,QAAQ,CAACiB,QAAzB,CAFJ;EAGA,MAAMC,aAAa,GAAG,CAAC,KAAKlB,QAAQ,CAACmB,KAAf,IAAwBvB,kBAA9C;EAEA,IAAIkB,OAAO,GAAGI,aAAa,GAAG,IAA9B,EAAoC;IAElCN,OAAO,GAAGQ,mBAAmB,CAACpB,QAAD,EAAW,CAAX,EAAcC,CAAd,CAA7B;IACAY,QAAQ,GAAGO,mBAAmB,CAACpB,QAAD,EAAWK,KAAX,EAAkBJ,CAAlB,CAA9B;EACD,CAJD,MAIO;IAELW,OAAO,GAAGL,SAAS,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,EAASC,YAAT,CAAnB;IACAK,QAAQ,GAAGN,SAAS,CAAC,CAACF,KAAD,EAAQ,CAAR,CAAD,EAAaG,YAAb,CAApB;EACD;EAED,OAAO,CAACE,UAAD,EAAaC,WAAb,EAA0BE,QAA1B,EAAoCD,OAApC,CAAP;AACD;AAQD,SAASQ,mBAATA,CAA6BpB,QAA7B,EAA4DqB,CAA5D,EAAuEZ,OAAvE,EAAkG;EAChG,MAAM;IAACa;EAAD,IAA4BtB,QAAlC;EACA,MAAMuB,MAAM,GAAG5B,eAAe,CAAC2B,uBAAD,EAA0B,CAACD,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAA1B,CAA9B;EACA,MAAMG,MAAM,GAAG7B,eAAe,CAAC2B,uBAAD,EAA0B,CAACD,CAAD,EAAIrB,QAAQ,CAACM,MAAb,EAAqB,CAArB,EAAwB,CAAxB,CAA1B,CAA9B;EAEA,MAAML,CAAC,GAAGQ,OAAO,GAAGT,QAAQ,CAACyB,cAAT,CAAwBC,aAAxB,CAAsC,CAAtC,CAApB;EACA,MAAMC,CAAC,GAAG,CAAC1B,CAAC,GAAGsB,MAAM,CAAC,CAAD,CAAX,KAAmBC,MAAM,CAAC,CAAD,CAAN,GAAYD,MAAM,CAAC,CAAD,CAArC,CAAV;EACA,MAAMK,KAAK,GAAGlC,IAAI,CAACmC,IAAL,CAAU,EAAV,EAAcN,MAAd,EAAsBC,MAAtB,EAA8BG,CAA9B,CAAd;EAEA,MAAMG,MAAM,GAAGrC,aAAa,CAACmC,KAAD,CAA5B;EACAE,MAAM,CAACC,IAAP,CAAYtB,OAAZ;EACA,OAAOqB,MAAP;AACD"},"metadata":{},"sourceType":"module","externalDependencies":[]}